<!DOCTYPE html>
<html>
<head>
    <title>Prompt Manager Debug</title>
    <style>
        body { font-family: monospace; padding: 20px; }
        .log { background: #f5f5f5; padding: 10px; margin: 10px 0; border-left: 3px solid #007bff; }
        .error { border-left-color: #dc3545; background: #fff5f5; }
        .success { border-left-color: #28a745; background: #f8fff8; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        #results { margin-top: 20px; }
    </style>
</head>
<body>
    <h1>Prompt Manager Debug Tool</h1>
    
    <div>
        <button onclick="testAPI()">Test API Endpoint</button>
        <button onclick="testFetchDirectly()">Test Fetch Directly</button>
        <button onclick="clearLogs()">Clear Logs</button>
    </div>

    <div id="logs"></div>
    <div id="results"></div>

    <script>
        function log(message, type = 'log') {
            const logs = document.getElementById('logs');
            const div = document.createElement('div');
            div.className = `log ${type}`;
            div.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
            logs.appendChild(div);
            console.log(message);
        }

        function clearLogs() {
            document.getElementById('logs').innerHTML = '';
            document.getElementById('results').innerHTML = '';
        }

        async function testAPI() {
            log('=== TESTING API ENDPOINT ===');
            log(`Current URL: ${window.location.href}`);
            log(`Testing fetch to: /prompts/api/prompts/list`);
            
            try {
                log('Starting fetch request...');
                const response = await fetch('/prompts/api/prompts/list');
                
                log(`Response received - Status: ${response.status}`, response.ok ? 'success' : 'error');
                log(`Response OK: ${response.ok}`);
                log(`Response headers: ${JSON.stringify([...response.headers.entries()])}`);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    log(`Error response text: ${errorText}`, 'error');
                    return;
                }
                
                log('Parsing JSON response...');
                const data = await response.json();
                
                log(`Response status field: ${data.status}`, data.status === 'success' ? 'success' : 'error');
                log(`Data array length: ${data.data ? data.data.length : 'undefined'}`);
                
                if (data.data && data.data.length > 0) {
                    log(`Sample prompt: ${JSON.stringify(data.data[0], null, 2)}`, 'success');
                    
                    // Display results
                    document.getElementById('results').innerHTML = 
                        `<h3>Success! Found ${data.data.length} prompts:</h3>` +
                        data.data.map(p => `<p>â€¢ ${p.name} (v${p.version}) - ${p.type}</p>`).join('');
                } else {
                    log('No prompts found in response', 'error');
                }
                
            } catch (error) {
                log(`=== FETCH ERROR ===`, 'error');
                log(`Error type: ${error.constructor.name}`, 'error');
                log(`Error message: ${error.message}`, 'error');
                log(`Error stack: ${error.stack}`, 'error');
            }
        }

        async function testFetchDirectly() {
            log('=== TESTING DIRECT FETCH ===');
            
            try {
                log('Testing with full URL...');
                const fullUrl = `${window.location.origin}/prompts/api/prompts/list`;
                log(`Full URL: ${fullUrl}`);
                
                const response = await fetch(fullUrl);
                log(`Direct fetch status: ${response.status}`, response.ok ? 'success' : 'error');
                
                const data = await response.json();
                log(`Direct fetch data: ${JSON.stringify(data)}`, 'success');
                
            } catch (error) {
                log(`Direct fetch error: ${error.message}`, 'error');
            }
        }

        // Auto-run test on page load
        window.addEventListener('DOMContentLoaded', () => {
            log('Page loaded, ready for testing');
            log(`Document ready state: ${document.readyState}`);
            log(`Current origin: ${window.location.origin}`);
        });
    </script>
</body>
</html>